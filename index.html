<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Delicatesses Estela</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #8B0000 0%, #DC143C 50%, #2F2F2F 100%); min-height: 100vh; color: #333; }
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
.hidden { display: none !important; }

/* Login mejorado */
.login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
.login-card { background: rgba(255,255,255,0.98); border-radius: 30px; padding: 50px; backdrop-filter: blur(15px); box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center; max-width: 500px; width: 100%; position: relative; }
.login-card::before { content: ''; position: absolute; top: -10px; left: -10px; right: -10px; bottom: -10px; background: linear-gradient(45deg, #8B0000, #DC143C, #2F2F2F); border-radius: 35px; z-index: -1; }
.logo { width: 180px; height: 180px; margin: 0 auto 30px; border-radius: 50%; overflow: hidden; border: 5px solid #DC143C; box-shadow: 0 10px 30px rgba(220,20,60,0.4); }
.logo img { width: 100%; height: 100%; object-fit: cover; }
.login-title { color: #8B0000; font-size: 2.8rem; margin-bottom: 40px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
.admin-section, .client-name-section { display: none; margin-top: 25px; }

/* Botones */
.btn { background: linear-gradient(45deg, #8B0000, #DC143C); color: white; border: none; padding: 15px 30px; border-radius: 30px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s ease; margin: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
.btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(139,0,0,0.4); }
.btn.client { background: linear-gradient(45deg, #2F2F2F, #4A4A4A); }
.btn.danger { background: linear-gradient(45deg, #8B0000, #A0001A); }
.btn.edit { background: linear-gradient(45deg, #DC143C, #B91C3C); }
.btn.success { background: linear-gradient(45deg, #2F4F2F, #228B22); }
input, textarea { padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 15px; width: 100%; margin: 8px 0; transition: border-color 0.3s; }
input:focus, textarea:focus { border-color: #DC143C; outline: none; box-shadow: 0 0 10px rgba(220,20,60,0.2); }

/* Header */
.header { text-align: center; margin-bottom: 30px; color: white; position: relative; }
.header h1 { font-size: 3rem; margin-bottom: 10px; text-shadow: 3px 3px 6px rgba(0,0,0,0.4); }
.mode-indicator { position: absolute; top: 0; right: 0; background: rgba(255,255,255,0.95); color: #8B0000; padding: 12px 25px; border-radius: 25px; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
.logout-btn { background: linear-gradient(45deg, #8B0000, #A0001A); padding: 10px 18px; border-radius: 20px; font-size: 13px; margin-left: 15px; }

/* Paneles */
.panel { background: rgba(255,255,255,0.98); border-radius: 20px; padding: 30px; backdrop-filter: blur(15px); box-shadow: 0 10px 40px rgba(0,0,0,0.15); margin-bottom: 25px; }
.panel-title { color: #8B0000; margin-bottom: 25px; font-size: 1.5rem; border-bottom: 3px solid #eee; padding-bottom: 15px; font-weight: bold; }
.form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }

/* Productos */
.products-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; margin-bottom: 30px; }
.product-card { background: rgba(255,255,255,0.98); border-radius: 20px; overflow: hidden; backdrop-filter: blur(15px); box-shadow: 0 10px 40px rgba(0,0,0,0.15); transition: all 0.3s ease; }
.product-card:hover { transform: translateY(-8px); box-shadow: 0 20px 50px rgba(0,0,0,0.25); }
.product-image { width: 100%; height: 220px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #999; background: linear-gradient(45deg, #f8f9fa, #e9ecef); }
.product-info { padding: 25px; }
.product-name { font-size: 1.4rem; font-weight: bold; margin-bottom: 12px; color: #2F2F2F; }
.product-price { font-size: 1.6rem; font-weight: bold; color: #DC143C; margin: 12px 0; }
.product-actions { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-top: 15px; }
.qty-input { width: 70px; text-align: center; padding: 8px; }

/* Carrito */
.cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 2px solid #eee; }
.cart-total { font-size: 1.6rem; font-weight: bold; color: #8B0000; text-align: right; margin: 20px 0; padding-top: 20px; border-top: 3px solid #eee; }
.empty-message { text-align: center; color: #999; font-style: italic; padding: 30px; font-size: 1.1rem; }

/* Chat flotante con contador */
.chat-float { position: fixed; bottom: 25px; right: 25px; width: 70px; height: 70px; background: linear-gradient(45deg, #8B0000, #DC143C); border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 28px; cursor: pointer; box-shadow: 0 8px 25px rgba(139,0,0,0.5); z-index: 1000; transition: all 0.3s ease; position: relative; }
.chat-float:hover { transform: scale(1.15); }
.chat-counter { position: absolute; top: -8px; right: -8px; background: #2F4F2F; color: white; border-radius: 50%; width: 25px; height: 25px; display: none; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; border: 2px solid white; }

/* Pedidos */
.orders-list { margin-bottom: 25px; }
.order-item { background: rgba(255,255,255,0.98); border-radius: 15px; padding: 20px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease; border-left: 5px solid #DC143C; position: relative; }
.order-item:hover { transform: translateX(8px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
.order-item.completed { opacity: 0.6; border-left-color: #2F4F2F; }
.order-item.has-messages { border-left-color: #2F2F2F; }
.order-header { display: flex; justify-content: space-between; align-items: center; font-weight: bold; margin-bottom: 8px; }
.order-details { font-size: 14px; color: #666; line-height: 1.4; }
.complete-btn { position: absolute; top: 15px; right: 15px; background: #2F4F2F; color: white; border: none; padding: 5px 10px; border-radius: 8px; font-size: 11px; cursor: pointer; }

/* Chat modal */
.chat-modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
.chat-content { background: white; margin: 5% auto; border-radius: 20px; width: 90%; max-width: 550px; height: 75vh; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
.chat-header { background: linear-gradient(45deg, #8B0000, #DC143C); color: white; padding: 25px; text-align: center; position: relative; }
.chat-close { position: absolute; right: 20px; top: 20px; background: none; border: none; color: white; font-size: 28px; cursor: pointer; font-weight: bold; }
.chat-messages { flex: 1; padding: 25px; overflow-y: auto; background: #f8f9fa; }
.chat-message { margin-bottom: 18px; padding: 12px 18px; border-radius: 20px; max-width: 85%; }
.chat-message.cliente { background: linear-gradient(45deg, #2F2F2F, #4A4A4A); color: white; margin-left: auto; }
.chat-message.admin { background: white; border: 2px solid #eee; }
.chat-input-area { padding: 25px; border-top: 2px solid #eee; display: flex; gap: 12px; }
.chat-input { flex: 1; border-radius: 30px; outline: none; font-size: 15px; }
.chat-send { background: linear-gradient(45deg, #8B0000, #DC143C); color: white; border: none; padding: 12px 25px; border-radius: 30px; cursor: pointer; font-weight: bold; }
.order-info { background: rgba(220,20,60,0.1); padding: 20px; margin-bottom: 25px; border-radius: 15px; border-left: 5px solid #DC143C; }

@media (max-width: 768px) {
.form-row { grid-template-columns: 1fr; }
.header h1 { font-size: 2.2rem; }
.products-grid { grid-template-columns: 1fr; }
.mode-indicator { position: static; margin-top: 15px; }
.logo { width: 150px; height: 150px; }
.login-title { font-size: 2.2rem; }
}
</style>
</head>
<body>
<div id="loginScreen" class="login-screen">
<div class="login-card">
<div class="logo">
<img src="logo.jpeg" alt="Delicatesses Estela" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
<div style="display:none;width:100%;height:100%;background:linear-gradient(45deg,#8B0000,#DC143C);align-items:center;justify-content:center;color:white;font-size:3rem;font-weight:bold;">üë®‚Äçüç≥</div>
</div>
<h1 class="login-title">Delicatesses Estela</h1>
<button class="btn client" onclick="show('clientNameSection'),$('clientName').focus()">üë§ Cliente</button>
<button class="btn" onclick="show('adminSection'),$('adminCode').focus()">üîê Admin</button>
<div id="clientNameSection" class="client-name-section">
<input type="text" id="clientName" placeholder="Tu nombre" onkeypress="event.key==='Enter'&&login('client')">
<button class="btn client" onclick="login('client')">‚úÖ Entrar</button>
</div>
<div id="adminSection" class="admin-section">
<input type="password" id="adminCode" placeholder="C√≥digo admin" onkeypress="event.key==='Enter'&&login('admin')">
<button class="btn" onclick="login('admin')">‚úÖ Entrar</button>
</div>
</div>
</div>

<div id="mainContent" class="container hidden">
<div class="header">
<h1>üõçÔ∏è Delicatesses Estela</h1>
<div class="mode-indicator">
<span id="modeText">üë§ Cliente</span>
<button class="logout-btn btn" onclick="logout()">üö™ Salir</button>
</div>
</div>

<div id="adminPanel" class="panel hidden">
<h2 class="panel-title">üìù Gesti√≥n de Productos</h2>
<form id="productForm" onsubmit="saveProduct(event)">
<div class="form-row">
<input type="text" id="productName" placeholder="Nombre" required>
<input type="number" id="productPrice" placeholder="Precio" step="0.01" required>
<input type="url" id="productImage" placeholder="URL imagen">
</div>
<textarea id="productDescription" placeholder="Descripci√≥n" rows="2"></textarea>
<button type="submit" class="btn" id="submitBtn">‚ûï Agregar</button>
<button type="button" class="btn" onclick="clearForm()">üîÑ Limpiar</button>
</form>
</div>

<div id="ordersPanel" class="panel hidden">
<h2 class="panel-title">üìã Pedidos Recibidos</h2>
<div id="ordersList" class="orders-list"><div class="empty-message">No hay pedidos</div></div>
</div>

<div class="products-grid" id="productsGrid"></div>

<div id="clientCart" class="panel">
<h2 class="panel-title">üõí Carrito</h2>
<div id="cartItems"><div class="empty-message">Carrito vac√≠o</div></div>
<div id="cartTotal" class="cart-total" style="display:none">Total: $0.00</div>
<div id="orderForm" style="display:none">
<div class="form-row">
<input type="tel" id="customerPhone" placeholder="Tel√©fono" required>
<input type="email" id="customerEmail" placeholder="Email (opcional)">
</div>
<button type="button" class="btn" onclick="submitOrder()">üöÄ Pedir</button>
<button type="button" class="btn danger" onclick="clearCart()">üóëÔ∏è Vaciar</button>
</div>
</div>
</div>

<div id="chatFloat" class="chat-float" onclick="openChat()">
üí¨
<div id="chatCounter" class="chat-counter">0</div>
</div>

<div id="chatModal" class="chat-modal" onclick="event.target===this&&closeChat()">
<div class="chat-content">
<div class="chat-header">
<h3 id="chatTitle">üí¨ Chat</h3>
<button class="chat-close" onclick="closeChat()">&times;</button>
</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input-area">
<input type="text" class="chat-input" id="chatInput" placeholder="Mensaje..." onkeypress="event.key==='Enter'&&sendMessage()">
<button class="chat-send" onclick="sendMessage()">Enviar</button>
</div>
</div>
</div>

<script>
let data={products:[{id:1,name:"Ejemplo Producto 1",price:29.99,description:"Producto de muestra",image:""},{id:2,name:"Ejemplo Producto 2",price:49.99,description:"Producto de muestra",image:""}],cart:[],orders:[],isAdmin:false,editingId:null,clientName:'',currentOrderId:null,messageCount:0};
const $=id=>document.getElementById(id),show=el=>(typeof el==='string'?$(el):el).style.display='block',hide=el=>(typeof el==='string'?$(el):el).classList.add('hidden');

function login(type){
if(type==='client'){
const name=$('clientName').value.trim();
if(!name)return alert('‚ùå Ingresa tu nombre');
data.clientName=name;
}else{
if($('adminCode').value!=='105')return alert('‚ùå C√≥digo incorrecto');
data.isAdmin=true;
}
$('mainContent').classList.remove('hidden');
hide('loginScreen');
$('modeText').textContent=data.isAdmin?'üîê Admin':`üë§ ${data.clientName}`;
if(data.isAdmin){
$('adminPanel').classList.remove('hidden');
$('ordersPanel').classList.remove('hidden');
hide('clientCart');
updateChatCounter();
}else{
hide('adminPanel');hide('ordersPanel');
$('clientCart').classList.remove('hidden');
}
render();
}

function logout(){
$('loginScreen').classList.remove('hidden');
hide('mainContent');
['adminSection','clientNameSection'].forEach(id=>$(id).style.display='none');
['adminCode','clientName'].forEach(id=>$(id).value='');
Object.assign(data,{isAdmin:false,clientName:'',currentOrderId:null,messageCount:0});
$('chatCounter').style.display='none';
}

function render(){
renderProducts();
!data.isAdmin&&renderCart();
data.isAdmin&&renderOrders();
}

function renderProducts(){
const grid=$('productsGrid');
if(!data.products.length)return grid.innerHTML='<div class="empty-message">No hay productos disponibles</div>';
grid.innerHTML=data.products.map(p=>`<div class="product-card"><div class="product-image">${p.image?`<img src="${p.image}" alt="${p.name}" style="width:100%;height:100%;object-fit:cover;">`:'üì¶'}</div><div class="product-info"><div class="product-name">${p.name}</div><div class="product-price">$${p.price.toFixed(2)}</div><div style="color:#666;margin:10px 0">${p.description||'Sin descripci√≥n'}</div><div class="product-actions">${!data.isAdmin?`<input type="number" class="qty-input" min="1" value="1" id="qty-${p.id}"><button class="btn" onclick="addToCart(${p.id})">üõí Agregar</button>`:`<button class="btn edit" onclick="editProduct(${p.id})">‚úèÔ∏è Editar</button><button class="btn danger" onclick="deleteProduct(${p.id})">üóëÔ∏è Eliminar</button>`}</div></div></div>`).join('');
}

function renderCart(){
const cartItems=$('cartItems'),cartTotal=$('cartTotal'),orderForm=$('orderForm');
if(!data.cart.length){
cartItems.innerHTML='<div class="empty-message">Carrito vac√≠o</div>';
cartTotal.style.display='none';
orderForm.style.display='none';
return;
}
cartItems.innerHTML=data.cart.map((item,i)=>`<div class="cart-item"><span>${item.name} x${item.quantity}</span><span>$${(item.price*item.quantity).toFixed(2)} <button class="btn danger" onclick="removeFromCart(${i})" style="padding:5px 10px;font-size:12px">‚ùå</button></span></div>`).join('');
const total=data.cart.reduce((sum,item)=>sum+(item.price*item.quantity),0);
cartTotal.textContent=`Total: $${total.toFixed(2)}`;
cartTotal.style.display='block';
orderForm.style.display='block';
}

function renderOrders(){
const ordersList=$('ordersList');
if(!data.orders.length)return ordersList.innerHTML='<div class="empty-message">No hay pedidos</div>';
ordersList.innerHTML=data.orders.map(order=>{
const hasMessages=order.messages.length>0,lastMessage=hasMessages?order.messages[order.messages.length-1]:null;
return`<div class="order-item ${hasMessages?'has-messages':''} ${order.completed?'completed':''}" onclick="openOrderChat(${order.id})">
<button class="complete-btn" onclick="event.stopPropagation();completeOrder(${order.id})">${order.completed?'‚úÖ':'üèÅ'}</button>
<div class="order-header"><span>üë§ ${order.client}</span><span>üí∞ $${order.total.toFixed(2)}</span></div>
<div class="order-details">üìû ${order.phone} | üõçÔ∏è ${order.items.map(item=>`${item.name} x${item.quantity}`).join(', ')}<br>‚è∞ ${order.timestamp}${lastMessage?`<br>üí¨ ${lastMessage.senderName}: ${lastMessage.message.substring(0,40)}${lastMessage.message.length>40?'...':''}`:''}</div></div>`;
}).join('');
}

function completeOrder(id){
const order=data.orders.find(o=>o.id===id);
if(order){
order.completed=!order.completed;
renderOrders();
alert(order.completed?'‚úÖ Pedido completado':'üîÑ Pedido reactivado');
}
}

function saveProduct(e){
e.preventDefault();
if(!data.isAdmin)return;
const name=$('productName').value.trim(),price=parseFloat($('productPrice').value),description=$('productDescription').value.trim(),image=$('productImage').value.trim();
if(!name||!price||price<=0)return alert('‚ùå Nombre y precio v√°lido son obligatorios');
if(data.editingId){
const product=data.products.find(p=>p.id===data.editingId);
product&&Object.assign(product,{name,price,description,image});
alert('‚úÖ Producto actualizado');
}else{
data.products.push({id:Date.now(),name,price,description,image});
alert('‚úÖ Producto agregado');
}
clearForm();render();
}

function editProduct(id){
if(!data.isAdmin)return;
const product=data.products.find(p=>p.id===id);
if(!product)return;
$('productName').value=product.name;
$('productPrice').value=product.price;
$('productDescription').value=product.description||'';
$('productImage').value=product.image||'';
data.editingId=id;
$('submitBtn').textContent='‚úÖ Actualizar';
window.scrollTo({top:0,behavior:'smooth'});
}

function deleteProduct(id){
data.isAdmin&&confirm('¬øEliminar producto?')&&(data.products=data.products.filter(p=>p.id!==id),render(),alert('‚úÖ Eliminado'));
}

function clearForm(){
$('productForm')?.reset();
data.editingId=null;
$('submitBtn').textContent='‚ûï Agregar';
}

function addToCart(productId){
if(data.isAdmin)return;
const product=data.products.find(p=>p.id===productId);
if(!product)return;
const qtyInput=$(`qty-${productId}`),quantity=parseInt(qtyInput.value)||1,existing=data.cart.find(item=>item.id===productId);
existing?existing.quantity+=quantity:data.cart.push({id:productId,name:product.name,price:product.price,quantity});
renderCart();qtyInput.value=1;
}

function removeFromCart(index){
data.cart.splice(index,1);renderCart();
}

function clearCart(){
confirm('¬øVaciar carrito?')&&(data.cart=[],renderCart());
}

function submitOrder(){
const phone=$('customerPhone').value.trim();
if(!phone)return alert('‚ùå Ingresa tu tel√©fono');
const total=data.cart.reduce((sum,item)=>sum+(item.price*item.quantity),0),order={id:Date.now(),client:data.clientName,phone,email:$('customerEmail').value.trim(),items:[...data.cart],total,timestamp:new Date().toLocaleString(),messages:[],completed:false};
data.orders.push(order);
data.cart=[];
alert(`üéâ ¬°PEDIDO CONFIRMADO!\n\nüë§ Cliente: ${data.clientName}\nüìû Tel√©fono: ${phone}\nüõçÔ∏è Total: $${total.toFixed(2)}\n\n¬°Usa el chat para coordinar!`);
$('chatFloat').style.display='flex';
renderCart();updateChatCounter();
}

function updateChatCounter(){
if(!data.isAdmin)return;
data.messageCount=data.orders.reduce((count,order)=>count+order.messages.filter(msg=>msg.sender==='cliente').length,0);
const counter=$('chatCounter');
if(data.messageCount>0){
counter.textContent=data.messageCount;
counter.style.display='flex';
}else{
counter.style.display='none';
}
}

function openChat(){
if(!data.isAdmin&&!data.orders.some(o=>o.client===data.clientName))return alert('‚ùå Primero realiza un pedido');
!data.isAdmin&&(data.currentOrderId=data.orders.find(o=>o.client===data.clientName)?.id);
$('chatModal').style.display='block';
loadChat();
}

function openOrderChat(orderId){
data.isAdmin&&(data.currentOrderId=orderId,$('chatModal').style.display='block',loadChat());
}

function closeChat(){
$('chatModal').style.display='none';
data.currentOrderId=null;
}

function sendMessage(){
const input=$('chatInput'),message=input.value.trim();
if(!message)return;
const order=data.orders.find(o=>o.id===data.currentOrderId);
if(!order)return;
const sender=data.isAdmin?'admin':'cliente',senderName=data.isAdmin?'Admin':data.clientName;
order.messages.push({sender,senderName,message,time:new Date().toLocaleTimeString()});
!data.isAdmin&&updateChatCounter();
loadChat();data.isAdmin&&renderOrders();
input.value='';
}

function loadChat(){
const container=$('chatMessages'),order=data.orders.find(o=>o.id===data.currentOrderId);
if(!order)return;
$('chatTitle').textContent=`üí¨ Chat con ${data.isAdmin?order.client:'Delicatesses Estela'}`;
container.innerHTML=`<div class="order-info"><h4>üìã Pedido</h4><p><strong>Cliente:</strong> ${order.client}</p><p><strong>Tel√©fono:</strong> ${order.phone}</p>${order.email?`<p><strong>Email:</strong> ${order.email}</p>`:''}><p><strong>Productos:</strong> ${order.items.map(item=>`${item.name} x${item.quantity}`).join(', ')}</p><p><strong>Total:</strong> $${order.total.toFixed(2)}</p></div>${order.messages.map(msg=>`<div class="chat-message ${msg.sender}"><strong>${msg.senderName}:</strong> ${msg.message}<div style="font-size:12px;opacity:0.7;margin-top:5px">${msg.time}</div></div>`).join('')}`;
container.scrollTop=container.scrollHeight;
}

render();
</script>
</body>
</html>